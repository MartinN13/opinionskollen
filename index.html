<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Opinionskollen</title>
<link rel="stylesheet" href="css/sierra.min.css">
<link rel="stylesheet" href="css/style.css">
<script src="js/mithril.min.js"></script>
<script src="js/MSXTransformer.js"></script>
<script src="js/jquery-2.2.3.min.js"></script>
<script src="js/main.js"></script>
</head>
<body>
<div class="nav">
  <li><a href="#/">Översikt</a></li>
  <li><a href="#/partier">Enskilda partier</a></li>
  <li><a href="#/forandring">Översikt förändring</a></li>
  <li><a href="#/partierforandring">Enskilda partier förändring</a></li>
</div>

<div class="container">
  <div class="aligner-space-between">
    <h1 class="text-big">Opinionskollen</h1>
    <button id="hamburger" class="hamburger hamburger--elastic" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
  </div>
</div>

<div id="main"></div>

<script type="text/msx;harmony=true">
/* components */
var Overview = {
  data: m.prop(),
  selected: m.prop(),
  selectedValue: 0,
  mostRecentValue: 0,

  init() {
    m.request({method: "GET", url: "json/data.json"}).then(this.data).then(function() {
      Overview.selected = Overview.data().data[Overview.data().data.length - 1].key[1];
      Overview.selectedValue = Overview.data().data.length - 1;
      Overview.mostRecentValue = Overview.data().data.length - 1;
    });
  },
  controller() {
    Overview.init();

    this.list = function() {
      var values = [],
          heights = [],
          year = "",
          period = "",
          selected = "",
          months = ["Januari", "Februari", "Mars", "April", "Maj", "Juni", "Juli", "Augusti",
                    "September", "Oktober", "November", "December"];

      for (var i = 0; i < Overview.data().data.length; i++) {
        if (Overview.data().data[i].key[1] == Overview.selected) {
          values.push(Overview.data().data[i]);
          heights.push(Overview.data().data[i].values * 2 + "%");
        }
      };

      year = Overview.selected.substring(0,4);
      period = Overview.selected.substring(5, 7);

      if (period >= 10) {
        period = months[period - 1];
      } else {
        period = Overview.selected.substring(6, 7);
        period = months[period - 1];
      };

      selected = period + " " + year;

      return [values, heights, selected];
    };

    this.previous = function() {
      if (Overview.selectedValue == 0) {
        /* tell user is on first period */
      } else {
        Overview.selectedValue--;
        Overview.selected = Overview.data().data[Overview.selectedValue].key[1];
      };
    };

    this.next = function() {
      if (Overview.selectedValue == Overview.mostRecentValue) {
        /* tell user is on last period */
      } else {
        Overview.selectedValue++;
        Overview.selected = Overview.data().data[Overview.selectedValue].key[1];
      };
    };
  },
  view(ctrl) {
    this.animate = function() {
      $(".v").animate({"height": ctrl.list()[1][5]});
      $(".s").animate({"height": ctrl.list()[1][4]});

      if (ctrl.list()[1][6] == "NaN%") {
        $(".mp").animate({"height": "1px"});
      } else {
        $(".mp").animate({"height": ctrl.list()[1][6]});
      };

      $(".c").animate({"height": ctrl.list()[1][0]});
      $(".l").animate({"height": ctrl.list()[1][1]});
      $(".m").animate({"height": ctrl.list()[1][2]});

      if (ctrl.list()[1][3] == "NaN%") {
        $(".kd").animate({"height": "1px"});
      } else {
        $(".kd").animate({"height": ctrl.list()[1][3]});
      };

      if (ctrl.list()[1][7] == "NaN%") {
        $(".sd").animate({"height": "1px"});
      } else {
        $(".sd").animate({"height": ctrl.list()[1][7]});
      };
    };

    return <div class="overview" config={this.animate}>
      <div class="container graph-menu">
      <h1 class="text-medium text-gray previous" onclick={ctrl.previous}>Före</h1>
      <h1 class="text-medium text-gray period">{ctrl.list()[2]}</h1>
      <h1 class="text-medium text-gray next" onclick={ctrl.next}>Efter</h1>
      </div>
      <div class="container graph">
        <div class="party v">
          <p>{ctrl.list()[0][5].key[0]}, {ctrl.list()[0][5].key[1]}, {ctrl.list()[0][5].values}</p>
        </div>
        <div class="party s">
          <p>{ctrl.list()[0][4].key[0]}, {ctrl.list()[0][4].key[1]}, {ctrl.list()[0][4].values}</p>
        </div>        
        <div class="party mp">
          <p>{ctrl.list()[0][6].key[0]}, {ctrl.list()[0][6].key[1]}, {ctrl.list()[0][6].values}</p>
        </div>
        <div class="party c">
          <p>{ctrl.list()[0][0].key[0]}, {ctrl.list()[0][0].key[1]}, {ctrl.list()[0][0].values}</p>
        </div>
        <div class="party l">
          <p>{ctrl.list()[0][1].key[0]}, {ctrl.list()[0][1].key[1]}, {ctrl.list()[0][1].values}</p>
        </div>
        <div class="party m">
          <p>{ctrl.list()[0][2].key[0]}, {ctrl.list()[0][2].key[1]}, {ctrl.list()[0][2].values}</p>
        </div>
        <div class="party kd">
          <p>{ctrl.list()[0][3].key[0]}, {ctrl.list()[0][3].key[1]}, {ctrl.list()[0][3].values}</p>
        </div>
        <div class="party sd">
          <p>{ctrl.list()[0][7].key[0]}, {ctrl.list()[0][7].key[1]}, {ctrl.list()[0][7].values}</p>
        </div>
      </div>
    </div>
  }
}

m.route(document.getElementById("main"), "/", {
    "/": Overview,
});
m.route.mode = "hash";

</script>

<footer class="background-dark">
  <div class="container">
    <div class="section text-center text-small">
      <h1 class="text-big text-with-subtitle">Opinionskollen</h1>
      <p class="text-gray">v1.0.0</p>
      <p>
        <a href="#">GitHub</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <a href="#">Second link</a>
        &nbsp;&nbsp;|&nbsp;&nbsp; 
        <a href="#">Third link</a>
      </p>
    </div>
  </div>
</footer>
</body>
</html>
